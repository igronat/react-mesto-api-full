{"ast":null,"code":"var _jsxFileName = \"/Users/TommyRadin/Desktop/\\u043C\\u043E\\u0438 \\u0432\\u0435\\u0431 \\u0440\\u0430\\u0437\\u0440\\u0430\\u0431\\u043E\\u0442\\u043A\\u0438/react-mesto-auth/src/components/App.js\",\n    _s = $RefreshSig$();\n\nimport React, { useState, useEffect } from 'react';\nimport { Route, Switch, Redirect, useHistory } from 'react-router-dom';\nimport Main from './Main';\nimport Footer from './Footer';\nimport ImagePopup from './ImagePopup';\nimport api from '../utils/Api';\nimport { CurrentUserContext } from '../contexts/CurrentUserContext.js';\nimport { EditProfilePopup } from './EditProfilePopup';\nimport { EditAvatarPopup } from './EditAvatarPopup';\nimport { AddPlacePopup } from './AddPlacePopup';\nimport Login from './Login';\nimport Register from './Register';\nimport ProtectedRoute from './ProtectedRoute';\nimport InfoTooltip from './InfoTooltip';\nimport * as auth from '../utils/Auth.js';\nimport ok from '../images/ok.jpg';\nimport bad from '../images/bad.jpg';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\n\nfunction App() {\n  _s();\n\n  const [isEditProfilePopupOpen, setEditProfilePopupOpen] = useState(false);\n  const [isAddPlacePopupOpen, setAddPlacePopupOpen] = useState(false);\n  const [isEditAvatarPopupOpen, setEditAvatarPopupOpen] = useState(false);\n  const [selectedCard, setSelectedCard] = useState(null);\n  const [currentUser, setCurrentUser] = useState({\n    name: '',\n    about: ''\n  });\n  const [cards, setCards] = useState([]);\n  const [loggedIn, setLoggedIn] = useState(false);\n  const history = useHistory();\n  const [isInfoTooltipOpen, setInfoTooltipOpen] = useState(false);\n  const [userData, setUserData] = useState({});\n  useEffect(() => {\n    tokenCheck();\n  }, []);\n  useEffect(() => {\n    if (loggedIn) {\n      api.getProfileInfo().then(user => {\n        setCurrentUser(user);\n      }).catch(err => console.log(`Ошибка профиля: ${err}`));\n      api.getInitialCards().then(res => {\n        setCards(res);\n      }).catch(err => console.log(`Ошибка при добавлении карточек: ${err}`));\n    }\n  }, [loggedIn]); // useEffect(() => {\n  //     const handleEscClose = (e) => {\n  //       if (e.key === \"Escape\") {\n  //         closeAllPopups();\n  //       }\n  //     };\n  //     document.addEventListener(\"keydown\", handleEscClose);\n  //     return () => document.removeEventListener(\"keydown\", handleEscClose);\n  //   }, []); \n\n  const handleRegister = (email, password) => {\n    return auth.register(email, password).then(res => {\n      if (res) {\n        history.push('/signin');\n        setInfoTooltipOpen(true);\n      }\n\n      setInfoTooltipOpen(true);\n    }).catch(err => {\n      console.log(`Ошибка регистрации пользователя: ${err}`);\n    });\n  };\n\n  const handleLogin = (email, password) => {\n    return auth.authorize(email, password).then(data => {\n      if (data.token) {\n        localStorage.setItem('token', data.token);\n        const userData = {\n          email,\n          password\n        };\n        setUserData(userData);\n        setLoggedIn({\n          loggedIn: true\n        });\n        history.push('/');\n      }\n    }).catch(err => {\n      console.log(`Ошибка авторизации пользователя: ${err}`);\n    });\n  };\n\n  function tokenCheck() {\n    if (localStorage.getItem('token')) {\n      let token = localStorage.getItem('token');\n      auth.getContent(token).then(_ref => {\n        let {\n          data\n        } = _ref;\n\n        if (data) {\n          let userData = {\n            email: data.email,\n            id: data._id\n          };\n          setUserData(userData);\n          setLoggedIn({\n            loggedIn: true\n          });\n          history.push('/');\n        }\n      });\n    }\n  }\n\n  const signOut = () => {\n    localStorage.removeItem('token');\n    history.push('/signin');\n  };\n\n  const handleEditAvatarClick = () => {\n    setEditAvatarPopupOpen(true);\n  };\n\n  const handleEditProfileClick = () => {\n    setEditProfilePopupOpen(true);\n  };\n\n  const handleAddPlaceClick = () => {\n    setAddPlacePopupOpen(true);\n  };\n\n  const handleCardClick = card => {\n    setSelectedCard(card);\n  };\n\n  const closeAllPopups = () => {\n    setEditProfilePopupOpen(false);\n    setAddPlacePopupOpen(false);\n    setEditAvatarPopupOpen(false);\n    setSelectedCard(null);\n    setInfoTooltipOpen(false);\n  };\n\n  const handleUpdateUser = user => {\n    api.editProfile(user).then(res => {\n      setCurrentUser(res);\n      setEditProfilePopupOpen(false);\n    }).catch(err => console.log(`Ошибка обновления профиля: ${err}`));\n  };\n\n  const handleUpdateAvatar = user => {\n    api.avatarProfile(user).then(res => {\n      setCurrentUser(res);\n      setEditAvatarPopupOpen(false);\n    }).catch(err => console.log(`Ошибка аватара: ${err}`));\n  };\n\n  const handleAddPlaceSubmit = user => {\n    api.addCard(user).then(res => {\n      setAddPlacePopupOpen(false);\n      setCards([res, ...cards]);\n    }).catch(err => console.log(`Ошибка аватара: ${err}`));\n  };\n\n  function handleCardLike(card) {\n    // Снова проверяем, есть ли уже лайк на этой карточке\n    const isLiked = card.likes.some(i => i._id === currentUser._id); // Отправляем запрос в API и получаем обновлённые данные карточки\n\n    api.changeLikeCardStatus(card._id, isLiked).then(newCard => {\n      setCards(state => state.map(c => c._id === card._id ? newCard : c));\n    });\n  }\n\n  ;\n\n  function handleCardDelete(card) {\n    // Снова проверяем, являемся ли мы владельцем текущей карточки\n    const isOwn = card.owner._id === currentUser._id; // Отправляем запрос в API и получаем обновлённые данные карточки\n\n    api.deleteCard(card._id, !isOwn).then(() => {\n      setCards(state => state.filter(c => c._id != card._id));\n    });\n  }\n\n  function componentCards() {\n    return /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: [/*#__PURE__*/_jsxDEV(Main, {\n        onEditAvatar: handleEditAvatarClick,\n        onEditProfile: handleEditProfileClick,\n        onAddPlace: handleAddPlaceClick,\n        onCardClick: handleCardClick,\n        cards: cards,\n        onCardsLike: handleCardLike,\n        onCardDelete: handleCardDelete,\n        userData: userData,\n        signOut: signOut\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 200,\n        columnNumber: 21\n      }, this), /*#__PURE__*/_jsxDEV(Footer, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 212,\n        columnNumber: 21\n      }, this), /*#__PURE__*/_jsxDEV(EditProfilePopup, {\n        isOpen: isEditProfilePopupOpen,\n        onClose: closeAllPopups,\n        onUpdateUser: handleUpdateUser\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 214,\n        columnNumber: 21\n      }, this), /*#__PURE__*/_jsxDEV(AddPlacePopup, {\n        isOpen: isAddPlacePopupOpen,\n        onClose: closeAllPopups,\n        onAddPlace: handleAddPlaceSubmit\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 220,\n        columnNumber: 21\n      }, this), /*#__PURE__*/_jsxDEV(EditAvatarPopup, {\n        isOpen: isEditAvatarPopupOpen,\n        onClose: closeAllPopups,\n        onUpdateAvatar: handleUpdateAvatar\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 226,\n        columnNumber: 21\n      }, this), /*#__PURE__*/_jsxDEV(ImagePopup, {\n        card: selectedCard,\n        onClose: closeAllPopups\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 232,\n        columnNumber: 21\n      }, this)]\n    }, void 0, true);\n  }\n\n  ;\n  return /*#__PURE__*/_jsxDEV(CurrentUserContext.Provider, {\n    value: currentUser,\n    children: /*#__PURE__*/_jsxDEV(Switch, {\n      children: [/*#__PURE__*/_jsxDEV(ProtectedRoute, {\n        exact: true,\n        path: \"/\",\n        loggedIn: loggedIn,\n        component: componentCards\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 245,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(Route, {\n        path: \"/signin\",\n        children: [/*#__PURE__*/_jsxDEV(Login, {\n          handleLogin: handleLogin\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 252,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(InfoTooltip, {\n          name: \"ok\",\n          img: ok,\n          title: \"\\u0412\\u044B \\u0443\\u0441\\u043F\\u0435\\u0448\\u043D\\u043E \\u0437\\u0430\\u0440\\u0435\\u0433\\u0438\\u0441\\u0442\\u0440\\u0438\\u0440\\u043E\\u0432\\u0430\\u043B\\u0438\\u0441\\u044C\",\n          isOpen: isInfoTooltipOpen,\n          onClose: closeAllPopups\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 253,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 251,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(Route, {\n        path: \"/signup\",\n        children: [/*#__PURE__*/_jsxDEV(Register, {\n          handleRegister: handleRegister\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 263,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(InfoTooltip, {\n          name: \"bad\",\n          img: bad,\n          title: \"\\u0427\\u0442\\u043E-\\u0442\\u043E \\u043F\\u043E\\u0448\\u043B\\u043E \\u043D\\u0435 \\u0442\\u0430\\u043A! \\u041F\\u043E\\u043F\\u0440\\u043E\\u0431\\u0443\\u0439\\u0442\\u0435 \\u0435\\u0449\\u0435 \\u0440\\u0430\\u0437.\",\n          isOpen: isInfoTooltipOpen,\n          onClose: closeAllPopups\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 266,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 262,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(Route, {\n        exact: true,\n        path: \"/\",\n        children: loggedIn ? /*#__PURE__*/_jsxDEV(Redirect, {\n          to: \"/\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 276,\n          columnNumber: 29\n        }, this) : /*#__PURE__*/_jsxDEV(Redirect, {\n          to: \"/signin\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 276,\n          columnNumber: 51\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 275,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 243,\n      columnNumber: 13\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 241,\n    columnNumber: 9\n  }, this);\n}\n\n_s(App, \"xgP9Jk7fW64ZaKKUz1BHhboGyTE=\", false, function () {\n  return [useHistory];\n});\n\n_c = App;\nexport default App;\n\nvar _c;\n\n$RefreshReg$(_c, \"App\");","map":{"version":3,"sources":["/Users/TommyRadin/Desktop/мои веб разработки/react-mesto-auth/src/components/App.js"],"names":["React","useState","useEffect","Route","Switch","Redirect","useHistory","Main","Footer","ImagePopup","api","CurrentUserContext","EditProfilePopup","EditAvatarPopup","AddPlacePopup","Login","Register","ProtectedRoute","InfoTooltip","auth","ok","bad","App","isEditProfilePopupOpen","setEditProfilePopupOpen","isAddPlacePopupOpen","setAddPlacePopupOpen","isEditAvatarPopupOpen","setEditAvatarPopupOpen","selectedCard","setSelectedCard","currentUser","setCurrentUser","name","about","cards","setCards","loggedIn","setLoggedIn","history","isInfoTooltipOpen","setInfoTooltipOpen","userData","setUserData","tokenCheck","getProfileInfo","then","user","catch","err","console","log","getInitialCards","res","handleRegister","email","password","register","push","handleLogin","authorize","data","token","localStorage","setItem","getItem","getContent","id","_id","signOut","removeItem","handleEditAvatarClick","handleEditProfileClick","handleAddPlaceClick","handleCardClick","card","closeAllPopups","handleUpdateUser","editProfile","handleUpdateAvatar","avatarProfile","handleAddPlaceSubmit","addCard","handleCardLike","isLiked","likes","some","i","changeLikeCardStatus","newCard","state","map","c","handleCardDelete","isOwn","owner","deleteCard","filter","componentCards"],"mappings":";;;AAAA,OAAOA,KAAP,IAAgBC,QAAhB,EAA0BC,SAA1B,QAA0C,OAA1C;AACA,SAASC,KAAT,EAAgBC,MAAhB,EAAwBC,QAAxB,EAAkCC,UAAlC,QAAoD,kBAApD;AACA,OAAOC,IAAP,MAAiB,QAAjB;AACA,OAAOC,MAAP,MAAmB,UAAnB;AACA,OAAOC,UAAP,MAAuB,cAAvB;AACA,OAAOC,GAAP,MAAgB,cAAhB;AACA,SAAQC,kBAAR,QAAiC,mCAAjC;AACA,SAAQC,gBAAR,QAA+B,oBAA/B;AACA,SAAQC,eAAR,QAA8B,mBAA9B;AACA,SAAQC,aAAR,QAA4B,iBAA5B;AACA,OAAOC,KAAP,MAAkB,SAAlB;AACA,OAAOC,QAAP,MAAqB,YAArB;AACA,OAAOC,cAAP,MAA2B,kBAA3B;AACA,OAAOC,WAAP,MAAwB,eAAxB;AACA,OAAO,KAAKC,IAAZ,MAAsB,kBAAtB;AACA,OAAOC,EAAP,MAAe,kBAAf;AACA,OAAOC,GAAP,MAAgB,mBAAhB;;;;AAEA,SAASC,GAAT,GAAe;AAAA;;AACX,QAAM,CAACC,sBAAD,EAAyBC,uBAAzB,IAAoDvB,QAAQ,CAAC,KAAD,CAAlE;AACA,QAAM,CAACwB,mBAAD,EAAsBC,oBAAtB,IAA8CzB,QAAQ,CAAC,KAAD,CAA5D;AACA,QAAM,CAAC0B,qBAAD,EAAwBC,sBAAxB,IAAkD3B,QAAQ,CAAC,KAAD,CAAhE;AACA,QAAM,CAAC4B,YAAD,EAAeC,eAAf,IAAkC7B,QAAQ,CAAC,IAAD,CAAhD;AACA,QAAM,CAAC8B,WAAD,EAAcC,cAAd,IAAgC/B,QAAQ,CAAC;AAACgC,IAAAA,IAAI,EAAE,EAAP;AAAWC,IAAAA,KAAK,EAAE;AAAlB,GAAD,CAA9C;AACA,QAAM,CAACC,KAAD,EAAQC,QAAR,IAAoBnC,QAAQ,CAAC,EAAD,CAAlC;AACA,QAAM,CAACoC,QAAD,EAAWC,WAAX,IAA0BrC,QAAQ,CAAC,KAAD,CAAxC;AACA,QAAMsC,OAAO,GAAGjC,UAAU,EAA1B;AACA,QAAM,CAACkC,iBAAD,EAAoBC,kBAApB,IAA0CxC,QAAQ,CAAC,KAAD,CAAxD;AACA,QAAM,CAACyC,QAAD,EAAWC,WAAX,IAA0B1C,QAAQ,CAAC,EAAD,CAAxC;AAEAC,EAAAA,SAAS,CAAC,MAAM;AACb0C,IAAAA,UAAU;AAEZ,GAHQ,EAGN,EAHM,CAAT;AAKA1C,EAAAA,SAAS,CAAC,MAAM;AACZ,QAAImC,QAAJ,EAAc;AACT3B,MAAAA,GAAG,CACHmC,cADA,GAEAC,IAFA,CAEMC,IAAD,IAAU;AACZf,QAAAA,cAAc,CAACe,IAAD,CAAd;AAEH,OALA,EAMAC,KANA,CAMMC,GAAG,IAAIC,OAAO,CAACC,GAAR,CAAa,mBAAkBF,GAAI,EAAnC,CANb;AAQDvC,MAAAA,GAAG,CACF0C,eADD,GAECN,IAFD,CAEOO,GAAD,IAAS;AACXjB,QAAAA,QAAQ,CAACiB,GAAD,CAAR;AAEH,OALD,EAMCL,KAND,CAMOC,GAAG,IAAIC,OAAO,CAACC,GAAR,CAAa,mCAAkCF,GAAI,EAAnD,CANd;AAMqE;AAC5E,GAjBQ,EAiBN,CAACZ,QAAD,CAjBM,CAAT,CAjBW,CAoCX;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AAEA;;AAEA,QAAMiB,cAAc,GAAG,CAACC,KAAD,EAAQC,QAAR,KAAqB;AACxC,WAAOrC,IAAI,CAACsC,QAAL,CAAcF,KAAd,EAAqBC,QAArB,EACNV,IADM,CACAO,GAAD,IAAS;AACX,UAAIA,GAAJ,EAAS;AACTd,QAAAA,OAAO,CAACmB,IAAR,CAAa,SAAb;AACAjB,QAAAA,kBAAkB,CAAC,IAAD,CAAlB;AACC;;AACDA,MAAAA,kBAAkB,CAAC,IAAD,CAAlB;AACH,KAPM,EAQNO,KARM,CAQCC,GAAD,IAAS;AAACC,MAAAA,OAAO,CAACC,GAAR,CAAa,oCAAmCF,GAAI,EAApD;AAAuD,KARjE,CAAP;AASH,GAVD;;AAYA,QAAMU,WAAW,GAAG,CAACJ,KAAD,EAAQC,QAAR,KAAqB;AACrC,WAAOrC,IAAI,CAACyC,SAAL,CAAeL,KAAf,EAAsBC,QAAtB,EACNV,IADM,CACAe,IAAD,IAAU;AACZ,UAAIA,IAAI,CAACC,KAAT,EAAe;AACfC,QAAAA,YAAY,CAACC,OAAb,CAAqB,OAArB,EAA8BH,IAAI,CAACC,KAAnC;AACA,cAAMpB,QAAQ,GAAG;AAAEa,UAAAA,KAAF;AAASC,UAAAA;AAAT,SAAjB;AACAb,QAAAA,WAAW,CAACD,QAAD,CAAX;AACAJ,QAAAA,WAAW,CAAC;AACRD,UAAAA,QAAQ,EAAE;AADF,SAAD,CAAX;AAGAE,QAAAA,OAAO,CAACmB,IAAR,CAAa,GAAb;AACA;AACH,KAXM,EAYNV,KAZM,CAYCC,GAAD,IAAS;AAACC,MAAAA,OAAO,CAACC,GAAR,CAAa,oCAAmCF,GAAI,EAApD;AAAuD,KAZjE,CAAP;AAaH,GAdD;;AAgBA,WAASL,UAAT,GAAsB;AAClB,QAAImB,YAAY,CAACE,OAAb,CAAqB,OAArB,CAAJ,EAAkC;AAChC,UAAIH,KAAK,GAAGC,YAAY,CAACE,OAAb,CAAqB,OAArB,CAAZ;AACA9C,MAAAA,IAAI,CAAC+C,UAAL,CAAgBJ,KAAhB,EACChB,IADD,CACM,QAAY;AAAA,YAAX;AAACe,UAAAA;AAAD,SAAW;;AAChB,YAAIA,IAAJ,EAAS;AACP,cAAInB,QAAQ,GAAG;AACba,YAAAA,KAAK,EAAEM,IAAI,CAACN,KADC;AAEbY,YAAAA,EAAE,EAAEN,IAAI,CAACO;AAFI,WAAf;AAIAzB,UAAAA,WAAW,CAACD,QAAD,CAAX;AACAJ,UAAAA,WAAW,CAAC;AACVD,YAAAA,QAAQ,EAAE;AADA,WAAD,CAAX;AAGFE,UAAAA,OAAO,CAACmB,IAAR,CAAa,GAAb;AACC;AACF,OAbD;AAcD;AACJ;;AAED,QAAMW,OAAO,GAAG,MAAM;AAClBN,IAAAA,YAAY,CAACO,UAAb,CAAwB,OAAxB;AACA/B,IAAAA,OAAO,CAACmB,IAAR,CAAa,SAAb;AACH,GAHD;;AAKA,QAAMa,qBAAqB,GAAG,MAAM;AAChC3C,IAAAA,sBAAsB,CAAC,IAAD,CAAtB;AACH,GAFD;;AAGA,QAAM4C,sBAAsB,GAAG,MAAM;AACjChD,IAAAA,uBAAuB,CAAC,IAAD,CAAvB;AACH,GAFD;;AAGA,QAAMiD,mBAAmB,GAAE,MAAM;AAC7B/C,IAAAA,oBAAoB,CAAC,IAAD,CAApB;AACH,GAFD;;AAGA,QAAMgD,eAAe,GAAIC,IAAD,IAAU;AAC9B7C,IAAAA,eAAe,CAAC6C,IAAD,CAAf;AACH,GAFD;;AAIA,QAAMC,cAAc,GAAG,MAAM;AACzBpD,IAAAA,uBAAuB,CAAC,KAAD,CAAvB;AACAE,IAAAA,oBAAoB,CAAC,KAAD,CAApB;AACAE,IAAAA,sBAAsB,CAAC,KAAD,CAAtB;AACAE,IAAAA,eAAe,CAAC,IAAD,CAAf;AACAW,IAAAA,kBAAkB,CAAC,KAAD,CAAlB;AACH,GAND;;AAQA,QAAMoC,gBAAgB,GAAI9B,IAAD,IAAU;AAC/BrC,IAAAA,GAAG,CACFoE,WADD,CACa/B,IADb,EAECD,IAFD,CAEMO,GAAG,IAAI;AACTrB,MAAAA,cAAc,CAACqB,GAAD,CAAd;AACA7B,MAAAA,uBAAuB,CAAC,KAAD,CAAvB;AAEH,KAND,EAOCwB,KAPD,CAOOC,GAAG,IAAIC,OAAO,CAACC,GAAR,CAAa,8BAA6BF,GAAI,EAA9C,CAPd;AAQH,GATD;;AAWA,QAAM8B,kBAAkB,GAAIhC,IAAD,IAAU;AACjCrC,IAAAA,GAAG,CACFsE,aADD,CACejC,IADf,EAECD,IAFD,CAEOO,GAAD,IAAS;AACXrB,MAAAA,cAAc,CAACqB,GAAD,CAAd;AACAzB,MAAAA,sBAAsB,CAAC,KAAD,CAAtB;AACH,KALD,EAMCoB,KAND,CAMOC,GAAG,IAAIC,OAAO,CAACC,GAAR,CAAa,mBAAkBF,GAAI,EAAnC,CANd;AAOH,GARD;;AAUA,QAAMgC,oBAAoB,GAAIlC,IAAD,IAAU;AACnCrC,IAAAA,GAAG,CACFwE,OADD,CACSnC,IADT,EAECD,IAFD,CAEOO,GAAD,IAAS;AACX3B,MAAAA,oBAAoB,CAAC,KAAD,CAApB;AACAU,MAAAA,QAAQ,CAAC,CAACiB,GAAD,EAAM,GAAGlB,KAAT,CAAD,CAAR;AACH,KALD,EAMCa,KAND,CAMOC,GAAG,IAAIC,OAAO,CAACC,GAAR,CAAa,mBAAkBF,GAAI,EAAnC,CANd;AAOH,GARD;;AAUA,WAASkC,cAAT,CAAwBR,IAAxB,EAA8B;AAC1B;AACA,UAAMS,OAAO,GAAGT,IAAI,CAACU,KAAL,CAAWC,IAAX,CAAgBC,CAAC,IAAIA,CAAC,CAACnB,GAAF,KAAUrC,WAAW,CAACqC,GAA3C,CAAhB,CAF0B,CAI1B;;AACA1D,IAAAA,GAAG,CACF8E,oBADD,CACsBb,IAAI,CAACP,GAD3B,EACgCgB,OADhC,EAECtC,IAFD,CAEO2C,OAAD,IAAa;AACfrD,MAAAA,QAAQ,CAAEsD,KAAD,IAAWA,KAAK,CAACC,GAAN,CAAWC,CAAD,IAAOA,CAAC,CAACxB,GAAF,KAAUO,IAAI,CAACP,GAAf,GAAqBqB,OAArB,GAA+BG,CAAhD,CAAZ,CAAR;AACH,KAJD;AAKH;;AAAA;;AAED,WAASC,gBAAT,CAA0BlB,IAA1B,EAAgC;AAC5B;AACA,UAAMmB,KAAK,GAAGnB,IAAI,CAACoB,KAAL,CAAW3B,GAAX,KAAmBrC,WAAW,CAACqC,GAA7C,CAF4B,CAI5B;;AACA1D,IAAAA,GAAG,CACFsF,UADD,CACYrB,IAAI,CAACP,GADjB,EACsB,CAAC0B,KADvB,EAEChD,IAFD,CAEM,MAAM;AACRV,MAAAA,QAAQ,CAAEsD,KAAD,IAAWA,KAAK,CAACO,MAAN,CAAcL,CAAD,IAAOA,CAAC,CAACxB,GAAF,IAASO,IAAI,CAACP,GAAlC,CAAZ,CAAR;AAEH,KALD;AAMH;;AAED,WAAS8B,cAAT,GAA0B;AACtB,wBAAO;AAAA,8BACK,QAAC,IAAD;AACA,QAAA,YAAY,EAAE3B,qBADd;AAEA,QAAA,aAAa,EAAEC,sBAFf;AAGA,QAAA,UAAU,EAAEC,mBAHZ;AAIA,QAAA,WAAW,EAAEC,eAJb;AAKA,QAAA,KAAK,EAAEvC,KALP;AAMA,QAAA,WAAW,EAAEgD,cANb;AAOA,QAAA,YAAY,EAAEU,gBAPd;AAQA,QAAA,QAAQ,EAAEnD,QARV;AASA,QAAA,OAAO,EAAE2B;AATT;AAAA;AAAA;AAAA;AAAA,cADL,eAaK,QAAC,MAAD;AAAA;AAAA;AAAA;AAAA,cAbL,eAeK,QAAC,gBAAD;AACA,QAAA,MAAM,EAAE9C,sBADR;AAEA,QAAA,OAAO,EAAEqD,cAFT;AAGA,QAAA,YAAY,EAAEC;AAHd;AAAA;AAAA;AAAA;AAAA,cAfL,eAqBK,QAAC,aAAD;AACA,QAAA,MAAM,EAAEpD,mBADR;AAEA,QAAA,OAAO,EAAEmD,cAFT;AAGA,QAAA,UAAU,EAAEK;AAHZ;AAAA;AAAA;AAAA;AAAA,cArBL,eA2BK,QAAC,eAAD;AACA,QAAA,MAAM,EAAEtD,qBADR;AAEA,QAAA,OAAO,EAAEiD,cAFT;AAGA,QAAA,cAAc,EAAEG;AAHhB;AAAA;AAAA;AAAA;AAAA,cA3BL,eAiCK,QAAC,UAAD;AACA,QAAA,IAAI,EAAIlD,YADR;AAEA,QAAA,OAAO,EAAI+C;AAFX;AAAA;AAAA;AAAA;AAAA,cAjCL;AAAA,oBAAP;AAuCH;;AAAC;AAEF,sBACI,QAAC,kBAAD,CAAoB,QAApB;AAA6B,IAAA,KAAK,EAAE7C,WAApC;AAAA,2BAEI,QAAC,MAAD;AAAA,8BAEI,QAAC,cAAD;AACA,QAAA,KAAK,MADL;AACM,QAAA,IAAI,EAAC,GADX;AAEA,QAAA,QAAQ,EAAEM,QAFV;AAGA,QAAA,SAAS,EAAE6D;AAHX;AAAA;AAAA;AAAA;AAAA,cAFJ,eAQI,QAAC,KAAD;AAAO,QAAA,IAAI,EAAC,SAAZ;AAAA,gCACI,QAAC,KAAD;AAAQ,UAAA,WAAW,EAAEvC;AAArB;AAAA;AAAA;AAAA;AAAA,gBADJ,eAEI,QAAC,WAAD;AACA,UAAA,IAAI,EAAE,IADN;AAEA,UAAA,GAAG,EAAEvC,EAFL;AAGA,UAAA,KAAK,EAAC,sKAHN;AAIA,UAAA,MAAM,EAAEoB,iBAJR;AAKA,UAAA,OAAO,EAAEoC;AALT;AAAA;AAAA;AAAA;AAAA,gBAFJ;AAAA;AAAA;AAAA;AAAA;AAAA,cARJ,eAmBI,QAAC,KAAD;AAAO,QAAA,IAAI,EAAC,SAAZ;AAAA,gCACI,QAAC,QAAD;AACA,UAAA,cAAc,EAAEtB;AADhB;AAAA;AAAA;AAAA;AAAA,gBADJ,eAII,QAAC,WAAD;AACA,UAAA,IAAI,EAAE,KADN;AAEA,UAAA,GAAG,EAAEjC,GAFL;AAGA,UAAA,KAAK,EAAC,qMAHN;AAIA,UAAA,MAAM,EAAEmB,iBAJR;AAKA,UAAA,OAAO,EAAEoC;AALT;AAAA;AAAA;AAAA;AAAA,gBAJJ;AAAA;AAAA;AAAA;AAAA;AAAA,cAnBJ,eAgCI,QAAC,KAAD;AAAO,QAAA,KAAK,MAAZ;AAAa,QAAA,IAAI,EAAC,GAAlB;AAAA,kBACCvC,QAAQ,gBAAG,QAAC,QAAD;AAAU,UAAA,EAAE,EAAC;AAAb;AAAA;AAAA;AAAA;AAAA,gBAAH,gBAAyB,QAAC,QAAD;AAAU,UAAA,EAAE,EAAC;AAAb;AAAA;AAAA;AAAA;AAAA;AADlC;AAAA;AAAA;AAAA;AAAA,cAhCJ;AAAA;AAAA;AAAA;AAAA;AAAA;AAFJ;AAAA;AAAA;AAAA;AAAA,UADJ;AA2CH;;GAxQQf,G;UAQWhB,U;;;KARXgB,G;AA0QT,eAAeA,GAAf","sourcesContent":["import React, { useState, useEffect} from 'react';\nimport { Route, Switch, Redirect, useHistory } from 'react-router-dom';\nimport Main from './Main';\nimport Footer from './Footer';\nimport ImagePopup from './ImagePopup';\nimport api from '../utils/Api';\nimport {CurrentUserContext} from '../contexts/CurrentUserContext.js';\nimport {EditProfilePopup} from './EditProfilePopup';\nimport {EditAvatarPopup} from './EditAvatarPopup';\nimport {AddPlacePopup} from './AddPlacePopup';\nimport Login from './Login';\nimport Register from './Register';\nimport ProtectedRoute from './ProtectedRoute';\nimport InfoTooltip from './InfoTooltip';\nimport * as auth from '../utils/Auth.js';\nimport ok from '../images/ok.jpg';\nimport bad from '../images/bad.jpg';\n\nfunction App() {\n    const [isEditProfilePopupOpen, setEditProfilePopupOpen] = useState(false);\n    const [isAddPlacePopupOpen, setAddPlacePopupOpen] = useState(false);\n    const [isEditAvatarPopupOpen, setEditAvatarPopupOpen] = useState(false);\n    const [selectedCard, setSelectedCard] = useState(null);\n    const [currentUser, setCurrentUser] = useState({name: '', about: ''});\n    const [cards, setCards] = useState([]);\n    const [loggedIn, setLoggedIn] = useState(false);\n    const history = useHistory();\n    const [isInfoTooltipOpen, setInfoTooltipOpen] = useState(false);\n    const [userData, setUserData] = useState({});\n   \n    useEffect(() => {\n       tokenCheck();\n       \n    }, [])\n\n    useEffect(() => {\n        if (loggedIn) {\n             api\n            .getProfileInfo()\n            .then((user) => {\n                setCurrentUser(user);\n                \n            })\n            .catch(err => console.log(`Ошибка профиля: ${err}`));\n\n            api\n            .getInitialCards()\n            .then((res) => {\n                setCards(res)\n                \n            })\n            .catch(err => console.log(`Ошибка при добавлении карточек: ${err}`))}\n    }, [loggedIn]); \n\n    // useEffect(() => {\n    //     const handleEscClose = (e) => {\n    //       if (e.key === \"Escape\") {\n    //         closeAllPopups();\n    //       }\n    //     };\n    \n    //     document.addEventListener(\"keydown\", handleEscClose);\n    \n    //     return () => document.removeEventListener(\"keydown\", handleEscClose);\n\n    //   }, []); \n\n    const handleRegister = (email, password) => {\n        return auth.register(email, password)\n        .then((res) => {\n            if (res) {\n            history.push('/signin');\n            setInfoTooltipOpen(true);\n            }\n            setInfoTooltipOpen(true)\n        })\n        .catch((err) => {console.log(`Ошибка регистрации пользователя: ${err}`)})\n    }\n\n    const handleLogin = (email, password) => {\n        return auth.authorize(email, password)\n        .then((data) => {\n            if (data.token){\n            localStorage.setItem('token', data.token);\n            const userData = { email, password }\n            setUserData(userData);\n            setLoggedIn({\n                loggedIn: true\n            });\n            history.push('/');\n           }\n        })\n        .catch((err) => {console.log(`Ошибка авторизации пользователя: ${err}`)})\n    } \n\n    function tokenCheck() {\n        if (localStorage.getItem('token')){\n          let token = localStorage.getItem('token');\n          auth.getContent(token)\n          .then(({data}) => {\n            if (data){\n              let userData = {\n                email: data.email,\n                id: data._id\n              }\n              setUserData(userData)\n              setLoggedIn({\n                loggedIn: true\n            });\n            history.push('/');\n            }\n          });\n        }\n    }\n\n    const signOut = () => {\n        localStorage.removeItem('token');\n        history.push('/signin');\n    }\n\n    const handleEditAvatarClick = () => {\n        setEditAvatarPopupOpen(true);\n    };\n    const handleEditProfileClick = () => {\n        setEditProfilePopupOpen(true);\n    }\n    const handleAddPlaceClick= () => {\n        setAddPlacePopupOpen(true);\n    }\n    const handleCardClick = (card) => {\n        setSelectedCard(card);\n    }\n    \n    const closeAllPopups = () => {\n        setEditProfilePopupOpen(false);\n        setAddPlacePopupOpen(false);\n        setEditAvatarPopupOpen(false);\n        setSelectedCard(null);\n        setInfoTooltipOpen(false)\n    }\n\n    const handleUpdateUser = (user) => {\n        api\n        .editProfile(user)\n        .then(res => {\n            setCurrentUser(res);\n            setEditProfilePopupOpen(false);\n        \n        })\n        .catch(err => console.log(`Ошибка обновления профиля: ${err}`));\n    };\n\n    const handleUpdateAvatar = (user) => {\n        api\n        .avatarProfile(user)\n        .then((res) => {\n            setCurrentUser(res);\n            setEditAvatarPopupOpen(false);\n        })\n        .catch(err => console.log(`Ошибка аватара: ${err}`));\n    };\n\n    const handleAddPlaceSubmit = (user) => {\n        api\n        .addCard(user)\n        .then((res) => {\n            setAddPlacePopupOpen(false);\n            setCards([res, ...cards]);\n        })\n        .catch(err => console.log(`Ошибка аватара: ${err}`));\n    }\n\n    function handleCardLike(card) {\n        // Снова проверяем, есть ли уже лайк на этой карточке\n        const isLiked = card.likes.some(i => i._id === currentUser._id);\n        \n        // Отправляем запрос в API и получаем обновлённые данные карточки\n        api\n        .changeLikeCardStatus(card._id, isLiked)\n        .then((newCard) => {\n            setCards((state) => state.map((c) => c._id === card._id ? newCard : c));\n        });\n    };\n    \n    function handleCardDelete(card) {\n        // Снова проверяем, являемся ли мы владельцем текущей карточки\n        const isOwn = card.owner._id === currentUser._id;\n        \n        // Отправляем запрос в API и получаем обновлённые данные карточки\n        api\n        .deleteCard(card._id, !isOwn)\n        .then(() => {\n            setCards((state) => state.filter((c) => c._id != card._id ));\n\n        });\n    } \n\n    function componentCards() {\n        return <>\n                    <Main\n                    onEditAvatar={handleEditAvatarClick}\n                    onEditProfile={handleEditProfileClick}\n                    onAddPlace={handleAddPlaceClick}\n                    onCardClick={handleCardClick}\n                    cards={cards}\n                    onCardsLike={handleCardLike}\n                    onCardDelete={handleCardDelete}\n                    userData={userData}\n                    signOut={signOut}\n                    />\n\n                    <Footer/>\n\n                    <EditProfilePopup \n                    isOpen={isEditProfilePopupOpen} \n                    onClose={closeAllPopups}\n                    onUpdateUser={handleUpdateUser} \n                    /> \n\n                    <AddPlacePopup \n                    isOpen={isAddPlacePopupOpen} \n                    onClose={closeAllPopups}\n                    onAddPlace={handleAddPlaceSubmit} \n                    />\n\n                    <EditAvatarPopup \n                    isOpen={isEditAvatarPopupOpen} \n                    onClose={closeAllPopups}\n                    onUpdateAvatar={handleUpdateAvatar} \n                    />\n\n                    <ImagePopup \n                    card = {selectedCard}\n                    onClose = {closeAllPopups}\n                    />\n\n                </>\n    } ;\n\n    return (  \n        <CurrentUserContext.Provider value={currentUser}>\n       \n            <Switch>\n\n                <ProtectedRoute\n                exact path=\"/\"\n                loggedIn={loggedIn}\n                component={componentCards}\n                />\n        \n                <Route path=\"/signin\">  \n                    <Login  handleLogin={handleLogin}/>\n                    <InfoTooltip \n                    name= 'ok'\n                    img={ok}\n                    title='Вы успешно зарегистрировались'\n                    isOpen={isInfoTooltipOpen}\n                    onClose={closeAllPopups}\n                    />\n                </Route>\n\n                <Route path=\"/signup\">\n                    <Register \n                    handleRegister={handleRegister}\n                    />\n                    <InfoTooltip \n                    name= 'bad'\n                    img={bad}\n                    title='Что-то пошло не так! Попробуйте еще раз.'\n                    isOpen={isInfoTooltipOpen}\n                    onClose={closeAllPopups}\n                    />\n                </Route>\n       \n                <Route exact path=\"/\">\n                {loggedIn ? <Redirect to=\"/\" /> : <Redirect to=\"/signin\" />}\n          \n                </Route>\n \n            </Switch>\n        </CurrentUserContext.Provider>\n    );\n}\n\nexport default App;"]},"metadata":{},"sourceType":"module"}