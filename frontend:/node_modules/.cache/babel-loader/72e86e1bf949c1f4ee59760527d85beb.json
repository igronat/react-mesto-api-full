{"ast":null,"code":"var _jsxFileName = \"/Users/TommyRadin/Desktop/\\u043C\\u043E\\u0438 \\u0432\\u0435\\u0431 \\u0440\\u0430\\u0437\\u0440\\u0430\\u0431\\u043E\\u0442\\u043A\\u0438/react-mesto-auth/src/components/App.js\",\n    _s = $RefreshSig$();\n\nimport React, { useState, useEffect } from \"react\";\nimport { Route, Switch, Redirect, useHistory } from \"react-router-dom\";\nimport Main from \"./Main\";\nimport Footer from \"./Footer\";\nimport ImagePopup from \"./ImagePopup\";\nimport api from \"../utils/Api\";\nimport { CurrentUserContext } from \"../contexts/CurrentUserContext.js\";\nimport { EditProfilePopup } from \"./EditProfilePopup\";\nimport { EditAvatarPopup } from \"./EditAvatarPopup\";\nimport { AddPlacePopup } from \"./AddPlacePopup\";\nimport Login from \"./Login\";\nimport Register from \"./Register\";\nimport ProtectedRoute from \"./ProtectedRoute\";\nimport InfoTooltip from \"./InfoTooltip\";\nimport * as auth from \"../utils/Auth.js\";\nimport ok from \"../images/ok.jpg\";\nimport bad from \"../images/bad.jpg\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\n\nfunction App() {\n  _s();\n\n  const [isEditProfilePopupOpen, setEditProfilePopupOpen] = useState(false);\n  const [isAddPlacePopupOpen, setAddPlacePopupOpen] = useState(false);\n  const [isEditAvatarPopupOpen, setEditAvatarPopupOpen] = useState(false);\n  const [selectedCard, setSelectedCard] = useState(null);\n  const [currentUser, setCurrentUser] = useState({\n    name: \"\",\n    about: \"\"\n  });\n  const [cards, setCards] = useState([]);\n  const [loggedIn, setLoggedIn] = useState(false);\n  const history = useHistory();\n  const [isInfoTooltipOpen, setInfoTooltipOpen] = useState(false);\n  const [userData, setUserData] = useState({});\n  useEffect(() => {\n    tokenCheck();\n  }, []);\n  useEffect(() => {\n    if (loggedIn) {\n      api.getProfileInfo().then(user => {\n        setCurrentUser(user);\n      }).catch(err => console.log(`Ошибка профиля: ${err}`));\n      api.getInitialCards().then(res => {\n        setCards(res);\n      }).catch(err => console.log(`Ошибка при добавлении карточек: ${err}`));\n    }\n  }, [loggedIn]); // useEffect(() => {\n  //     const handleEscClose = (e) => {\n  //       if (e.key === \"Escape\") {\n  //         closeAllPopups();\n  //       }\n  //     };\n  //     document.addEventListener(\"keydown\", handleEscClose);\n  //     return () => document.removeEventListener(\"keydown\", handleEscClose);\n  //   }, []);\n\n  const handleRegister = (email, password) => {\n    return auth.register(email, password).then(res => {\n      if (res) {\n        history.push(\"/signin\");\n        setInfoTooltipOpen(true);\n      }\n\n      setInfoTooltipOpen(true);\n    }).catch(err => {\n      console.log(`Ошибка регистрации пользователя: ${err}`);\n    });\n  };\n\n  const handleLogin = (email, password) => {\n    return auth.authorize(email, password).then(data => {\n      if (data.token) {\n        localStorage.setItem(\"token\", data.token);\n        const userData = {\n          email,\n          password\n        };\n        setUserData(userData);\n        setLoggedIn({\n          loggedIn: true\n        });\n        history.push(\"/\");\n      }\n    }).catch(err => {\n      console.log(`Ошибка авторизации пользователя: ${err}`);\n    });\n  };\n\n  function tokenCheck() {\n    if (localStorage.getItem(\"token\")) {\n      let token = localStorage.getItem(\"token\");\n      auth.getContent(token).then(_ref => {\n        let {\n          data\n        } = _ref;\n\n        if (data) {\n          let userData = {\n            email: data.email,\n            id: data._id\n          };\n          setUserData(userData);\n          setLoggedIn({\n            loggedIn: true\n          });\n          history.push(\"/\");\n        }\n      });\n    }\n  }\n\n  const signOut = () => {\n    localStorage.removeItem(\"token\");\n    history.push(\"/signin\");\n  };\n\n  const handleEditAvatarClick = () => {\n    setEditAvatarPopupOpen(true);\n  };\n\n  const handleEditProfileClick = () => {\n    setEditProfilePopupOpen(true);\n  };\n\n  const handleAddPlaceClick = () => {\n    setAddPlacePopupOpen(true);\n  };\n\n  const handleCardClick = card => {\n    setSelectedCard(card);\n  };\n\n  const closeAllPopups = () => {\n    setEditProfilePopupOpen(false);\n    setAddPlacePopupOpen(false);\n    setEditAvatarPopupOpen(false);\n    setSelectedCard(null);\n    setInfoTooltipOpen(false);\n  };\n\n  const handleUpdateUser = user => {\n    api.editProfile(user).then(res => {\n      setCurrentUser(res);\n      setEditProfilePopupOpen(false);\n    }).catch(err => console.log(`Ошибка обновления профиля: ${err}`));\n  };\n\n  const handleUpdateAvatar = user => {\n    api.avatarProfile(user).then(res => {\n      setCurrentUser(res);\n      setEditAvatarPopupOpen(false);\n    }).catch(err => console.log(`Ошибка аватара: ${err}`));\n  };\n\n  const handleAddPlaceSubmit = user => {\n    api.addCard(user).then(res => {\n      setAddPlacePopupOpen(false);\n      setCards([res, ...cards]);\n    }).catch(err => console.log(`Ошибка аватара: ${err}`));\n  };\n\n  function handleCardLike(card) {\n    // Снова проверяем, есть ли уже лайк на этой карточке\n    const isLiked = card.likes.some(i => i._id === currentUser._id); // Отправляем запрос в API и получаем обновлённые данные карточки\n\n    api.changeLikeCardStatus(card._id, isLiked).then(newCard => {\n      setCards(state => state.map(c => c._id === card._id ? newCard : c));\n    });\n  }\n\n  function handleCardDelete(card) {\n    // Снова проверяем, являемся ли мы владельцем текущей карточки\n    const isOwn = card.owner._id === currentUser._id; // Отправляем запрос в API и получаем обновлённые данные карточки\n\n    api.deleteCard(card._id, !isOwn).then(() => {\n      setCards(state => state.filter(c => c._id != card._id));\n    });\n  }\n\n  function componentCards() {\n    return /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: [/*#__PURE__*/_jsxDEV(Main, {\n        onEditAvatar: handleEditAvatarClick,\n        onEditProfile: handleEditProfileClick,\n        onAddPlace: handleAddPlaceClick,\n        onCardClick: handleCardClick,\n        cards: cards,\n        onCardsLike: handleCardLike,\n        onCardDelete: handleCardDelete,\n        userData: userData,\n        signOut: signOut\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 199,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Footer, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 211,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(EditProfilePopup, {\n        isOpen: isEditProfilePopupOpen,\n        onClose: closeAllPopups,\n        onUpdateUser: handleUpdateUser\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 213,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(AddPlacePopup, {\n        isOpen: isAddPlacePopupOpen,\n        onClose: closeAllPopups,\n        onAddPlace: handleAddPlaceSubmit\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 219,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(EditAvatarPopup, {\n        isOpen: isEditAvatarPopupOpen,\n        onClose: closeAllPopups,\n        onUpdateAvatar: handleUpdateAvatar\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 225,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(ImagePopup, {\n        card: selectedCard,\n        onClose: closeAllPopups\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 231,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true);\n  }\n\n  function isSuccess() {\n    return /*#__PURE__*/_jsxDEV(InfoTooltip, {\n      name: \"ok\",\n      img: ok,\n      title: \"\\u0412\\u044B \\u0443\\u0441\\u043F\\u0435\\u0448\\u043D\\u043E \\u0437\\u0430\\u0440\\u0435\\u0433\\u0438\\u0441\\u0442\\u0440\\u0438\\u0440\\u043E\\u0432\\u0430\\u043B\\u0438\\u0441\\u044C\",\n      isOpen: isInfoTooltipOpen,\n      onClose: closeAllPopups\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 238,\n      columnNumber: 9\n    }, this);\n  }\n\n  return /*#__PURE__*/_jsxDEV(CurrentUserContext.Provider, {\n    value: currentUser,\n    children: /*#__PURE__*/_jsxDEV(Switch, {\n      children: [/*#__PURE__*/_jsxDEV(ProtectedRoute, {\n        exact: true,\n        path: \"/\",\n        loggedIn: loggedIn,\n        component: componentCards\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 252,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Route, {\n        path: \"/signin\",\n        children: /*#__PURE__*/_jsxDEV(Login, {\n          handleLogin: handleLogin,\n          isSuccess: isSuccess\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 260,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 259,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Route, {\n        path: \"/signup\",\n        children: [/*#__PURE__*/_jsxDEV(Register, {\n          handleRegister: handleRegister\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 273,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(InfoTooltip, {\n          name: \"bad\",\n          img: bad,\n          title: \"\\u0427\\u0442\\u043E-\\u0442\\u043E \\u043F\\u043E\\u0448\\u043B\\u043E \\u043D\\u0435 \\u0442\\u0430\\u043A! \\u041F\\u043E\\u043F\\u0440\\u043E\\u0431\\u0443\\u0439\\u0442\\u0435 \\u0435\\u0449\\u0435 \\u0440\\u0430\\u0437.\",\n          isOpen: isInfoTooltipOpen,\n          onClose: closeAllPopups\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 274,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 272,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Route, {\n        exact: true,\n        path: \"/\",\n        children: loggedIn ? /*#__PURE__*/_jsxDEV(Redirect, {\n          to: \"/\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 284,\n          columnNumber: 23\n        }, this) : /*#__PURE__*/_jsxDEV(Redirect, {\n          to: \"/signin\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 284,\n          columnNumber: 45\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 283,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 251,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 250,\n    columnNumber: 5\n  }, this);\n}\n\n_s(App, \"nXK9hAe3Ox7Ng5g2gQ/1icLckW0=\", false, function () {\n  return [useHistory];\n});\n\n_c = App;\nexport default App;\n\nvar _c;\n\n$RefreshReg$(_c, \"App\");","map":{"version":3,"sources":["/Users/TommyRadin/Desktop/мои веб разработки/react-mesto-auth/src/components/App.js"],"names":["React","useState","useEffect","Route","Switch","Redirect","useHistory","Main","Footer","ImagePopup","api","CurrentUserContext","EditProfilePopup","EditAvatarPopup","AddPlacePopup","Login","Register","ProtectedRoute","InfoTooltip","auth","ok","bad","App","isEditProfilePopupOpen","setEditProfilePopupOpen","isAddPlacePopupOpen","setAddPlacePopupOpen","isEditAvatarPopupOpen","setEditAvatarPopupOpen","selectedCard","setSelectedCard","currentUser","setCurrentUser","name","about","cards","setCards","loggedIn","setLoggedIn","history","isInfoTooltipOpen","setInfoTooltipOpen","userData","setUserData","tokenCheck","getProfileInfo","then","user","catch","err","console","log","getInitialCards","res","handleRegister","email","password","register","push","handleLogin","authorize","data","token","localStorage","setItem","getItem","getContent","id","_id","signOut","removeItem","handleEditAvatarClick","handleEditProfileClick","handleAddPlaceClick","handleCardClick","card","closeAllPopups","handleUpdateUser","editProfile","handleUpdateAvatar","avatarProfile","handleAddPlaceSubmit","addCard","handleCardLike","isLiked","likes","some","i","changeLikeCardStatus","newCard","state","map","c","handleCardDelete","isOwn","owner","deleteCard","filter","componentCards","isSuccess"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport { Route, Switch, Redirect, useHistory } from \"react-router-dom\";\nimport Main from \"./Main\";\nimport Footer from \"./Footer\";\nimport ImagePopup from \"./ImagePopup\";\nimport api from \"../utils/Api\";\nimport { CurrentUserContext } from \"../contexts/CurrentUserContext.js\";\nimport { EditProfilePopup } from \"./EditProfilePopup\";\nimport { EditAvatarPopup } from \"./EditAvatarPopup\";\nimport { AddPlacePopup } from \"./AddPlacePopup\";\nimport Login from \"./Login\";\nimport Register from \"./Register\";\nimport ProtectedRoute from \"./ProtectedRoute\";\nimport InfoTooltip from \"./InfoTooltip\";\nimport * as auth from \"../utils/Auth.js\";\nimport ok from \"../images/ok.jpg\";\nimport bad from \"../images/bad.jpg\";\n\nfunction App() {\n  const [isEditProfilePopupOpen, setEditProfilePopupOpen] = useState(false);\n  const [isAddPlacePopupOpen, setAddPlacePopupOpen] = useState(false);\n  const [isEditAvatarPopupOpen, setEditAvatarPopupOpen] = useState(false);\n  const [selectedCard, setSelectedCard] = useState(null);\n  const [currentUser, setCurrentUser] = useState({ name: \"\", about: \"\" });\n  const [cards, setCards] = useState([]);\n  const [loggedIn, setLoggedIn] = useState(false);\n  const history = useHistory();\n  const [isInfoTooltipOpen, setInfoTooltipOpen] = useState(false);\n  const [userData, setUserData] = useState({});\n\n  useEffect(() => {\n    tokenCheck();\n  }, []);\n\n  useEffect(() => {\n    if (loggedIn) {\n      api\n        .getProfileInfo()\n        .then((user) => {\n          setCurrentUser(user);\n        })\n        .catch((err) => console.log(`Ошибка профиля: ${err}`));\n\n      api\n        .getInitialCards()\n        .then((res) => {\n          setCards(res);\n        })\n        .catch((err) => console.log(`Ошибка при добавлении карточек: ${err}`));\n    }\n  }, [loggedIn]);\n\n  // useEffect(() => {\n  //     const handleEscClose = (e) => {\n  //       if (e.key === \"Escape\") {\n  //         closeAllPopups();\n  //       }\n  //     };\n\n  //     document.addEventListener(\"keydown\", handleEscClose);\n\n  //     return () => document.removeEventListener(\"keydown\", handleEscClose);\n\n  //   }, []);\n\n  const handleRegister = (email, password) => {\n    return auth\n      .register(email, password)\n      .then((res) => {\n        if (res) {\n          history.push(\"/signin\");\n          \n          setInfoTooltipOpen(true);\n        }\n        setInfoTooltipOpen(true);\n      })\n      .catch((err) => {\n        console.log(`Ошибка регистрации пользователя: ${err}`);\n      });\n  };\n\n  const handleLogin = (email, password) => {\n    return auth\n      .authorize(email, password)\n      .then((data) => {\n        if (data.token) {\n          localStorage.setItem(\"token\", data.token);\n          const userData = { email, password };\n          setUserData(userData);\n          setLoggedIn({\n            loggedIn: true,\n          });\n          history.push(\"/\");\n        }\n      })\n      .catch((err) => {\n        console.log(`Ошибка авторизации пользователя: ${err}`);\n      });\n  };\n\n  function tokenCheck() {\n    if (localStorage.getItem(\"token\")) {\n      let token = localStorage.getItem(\"token\");\n      auth.getContent(token).then(({ data }) => {\n        if (data) {\n          let userData = {\n            email: data.email,\n            id: data._id,\n          };\n          setUserData(userData);\n          setLoggedIn({\n            loggedIn: true,\n          });\n          history.push(\"/\");\n        }\n      });\n    }\n  }\n\n  const signOut = () => {\n    localStorage.removeItem(\"token\");\n    history.push(\"/signin\");\n  };\n\n  const handleEditAvatarClick = () => {\n    setEditAvatarPopupOpen(true);\n  };\n  const handleEditProfileClick = () => {\n    setEditProfilePopupOpen(true);\n  };\n  const handleAddPlaceClick = () => {\n    setAddPlacePopupOpen(true);\n  };\n  const handleCardClick = (card) => {\n    setSelectedCard(card);\n  };\n\n  const closeAllPopups = () => {\n    setEditProfilePopupOpen(false);\n    setAddPlacePopupOpen(false);\n    setEditAvatarPopupOpen(false);\n    setSelectedCard(null);\n    setInfoTooltipOpen(false);\n  };\n\n  const handleUpdateUser = (user) => {\n    api\n      .editProfile(user)\n      .then((res) => {\n        setCurrentUser(res);\n        setEditProfilePopupOpen(false);\n      })\n      .catch((err) => console.log(`Ошибка обновления профиля: ${err}`));\n  };\n\n  const handleUpdateAvatar = (user) => {\n    api\n      .avatarProfile(user)\n      .then((res) => {\n        setCurrentUser(res);\n        setEditAvatarPopupOpen(false);\n      })\n      .catch((err) => console.log(`Ошибка аватара: ${err}`));\n  };\n\n  const handleAddPlaceSubmit = (user) => {\n    api\n      .addCard(user)\n      .then((res) => {\n        setAddPlacePopupOpen(false);\n        setCards([res, ...cards]);\n      })\n      .catch((err) => console.log(`Ошибка аватара: ${err}`));\n  };\n\n  function handleCardLike(card) {\n    // Снова проверяем, есть ли уже лайк на этой карточке\n    const isLiked = card.likes.some((i) => i._id === currentUser._id);\n\n    // Отправляем запрос в API и получаем обновлённые данные карточки\n    api.changeLikeCardStatus(card._id, isLiked).then((newCard) => {\n      setCards((state) => state.map((c) => (c._id === card._id ? newCard : c)));\n    });\n  }\n\n  function handleCardDelete(card) {\n    // Снова проверяем, являемся ли мы владельцем текущей карточки\n    const isOwn = card.owner._id === currentUser._id;\n\n    // Отправляем запрос в API и получаем обновлённые данные карточки\n    api.deleteCard(card._id, !isOwn).then(() => {\n      setCards((state) => state.filter((c) => c._id != card._id));\n    });\n  }\n\n  function componentCards() {\n    return (\n      <>\n        <Main\n          onEditAvatar={handleEditAvatarClick}\n          onEditProfile={handleEditProfileClick}\n          onAddPlace={handleAddPlaceClick}\n          onCardClick={handleCardClick}\n          cards={cards}\n          onCardsLike={handleCardLike}\n          onCardDelete={handleCardDelete}\n          userData={userData}\n          signOut={signOut}\n        />\n\n        <Footer />\n\n        <EditProfilePopup\n          isOpen={isEditProfilePopupOpen}\n          onClose={closeAllPopups}\n          onUpdateUser={handleUpdateUser}\n        />\n\n        <AddPlacePopup\n          isOpen={isAddPlacePopupOpen}\n          onClose={closeAllPopups}\n          onAddPlace={handleAddPlaceSubmit}\n        />\n\n        <EditAvatarPopup\n          isOpen={isEditAvatarPopupOpen}\n          onClose={closeAllPopups}\n          onUpdateAvatar={handleUpdateAvatar}\n        />\n\n        <ImagePopup card={selectedCard} onClose={closeAllPopups} />\n      </>\n    );\n  }\n\n  function isSuccess() {\n      return (\n        <InfoTooltip\n        name=\"ok\"\n        img={ok}\n        title=\"Вы успешно зарегистрировались\"\n        isOpen={isInfoTooltipOpen}\n        onClose={closeAllPopups}\n      />\n\n      )\n  }\n\n  return (\n    <CurrentUserContext.Provider value={currentUser}>\n      <Switch>\n        <ProtectedRoute\n          exact\n          path=\"/\"\n          loggedIn={loggedIn}\n          component={componentCards}\n        />\n\n        <Route path=\"/signin\">\n          <Login \n          handleLogin={handleLogin} \n          isSuccess={isSuccess}/>\n          {/* <InfoTooltip\n            name=\"ok\"\n            img={ok}\n            title=\"Вы успешно зарегистрировались\"\n            isOpen={isInfoTooltipOpen}\n            onClose={closeAllPopups}\n          /> */}\n        </Route>\n\n        <Route path=\"/signup\">\n          <Register handleRegister={handleRegister} />\n          <InfoTooltip\n            name=\"bad\"\n            img={bad}\n            title=\"Что-то пошло не так! Попробуйте еще раз.\"\n            isOpen={isInfoTooltipOpen}\n            onClose={closeAllPopups}\n          />\n        </Route>\n\n        <Route exact path=\"/\">\n          {loggedIn ? <Redirect to=\"/\" /> : <Redirect to=\"/signin\" />}\n        </Route>\n      </Switch>\n    </CurrentUserContext.Provider>\n  );\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}